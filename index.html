<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ocarina Fingering Trainer</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0066ff;
      --bg: #f4f7fe;
      --surface: #ffffff;
      --radius: 12px;
    }
    * { box-sizing: border-box; }
    body {
      font-family: "Noto Sans JP", system-ui, sans-serif;
      margin: 0;
      background: var(--bg);
      color: #222;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background: var(--surface);
      box-shadow: 0 2px 6px rgba(0,0,0,.05);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      gap: 1rem;
    }
    header h1 {
      font-size: 1.4rem;
      font-weight: 600;
      margin: 0;
    }
    /* ---------------- Tabs --------------- */
    .tabs {
      display: flex;
      gap: 0.2rem;
      margin-top: 1rem;
    }
    .tabs button {
      flex: 1 1 0;
      border: none;
      background: var(--surface);
      padding: 0.6rem 1rem;
      border-radius: var(--radius) var(--radius) 0 0;
      cursor: pointer;
      font-weight: 600;
      color: #444;
      transition: background .2s, color .2s;
    }
    .tabs button.active {
      background: var(--primary);
      color: #fff;
    }
    main {
      flex: 1;
      padding: 0 2rem 2rem;
    }
    section {
      background: var(--surface);
      border-radius: 0 var(--radius) var(--radius) var(--radius);
      padding: 1.5rem;
      display: none;
      box-shadow: 0 2px 6px rgba(0,0,0,.05);
    }
    section.active { display:block; }

    /* ------------- Piano ----------------- */
    .piano {
      position: relative;
      user-select: none;
      width: max-content;
      margin: 1rem auto;
    }
    .white-key, .black-key {
      display: inline-block;
      cursor: pointer;
      border: 1px solid #444;
    }
    .white-key {
      width: 36px;
      height: 160px;
      background: #fff;
    }
    .white-key.active { background:#cfe4ff; }
    .black-key {
      position: absolute;
      width: 26px;
      height: 100px;
      background: #000;
      margin-left: -13px;
      z-index: 1;
      border: 1px solid #000;
    }
    .black-key.active { background:#5585ff; }

    /* ------------- Fingering Image Cards ------------- */
    .board {
      display:flex;
      flex-wrap:wrap;
      gap:1.2rem;
      justify-content:center;
      margin-top:1.5rem;
    }
    .card {
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:0.4rem;
    }
    .card img {
      width:120px;
      height:auto;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,.15));
    }
    .note-label {
      font-weight:600;
    }
    /* ------------- Inputs -------------- */
    .seq-wrapper { max-width:600px;margin:0 auto;text-align:center; }
    #seq-input {
      width:100%;padding:0.6rem;border:1px solid #aaa;border-radius:6px;font-size:1rem;
    }
    .btn {
      margin-top:0.8rem;padding:0.6rem 1.2rem;border:none;border-radius:6px;background:var(--primary);color:#fff;font-weight:600;cursor:pointer;
    }
  </style>
</head>
<body>
  <header>
    <h1>Ocarina Fingering Trainer</h1>
  </header>
  <main>
    <!-- Tabs -->
    <div class="tabs">
      <button id="tab-key" class="active">鍵盤で探す</button>
      <button id="tab-seq">入力で表示</button>
    </div>

    <!-- ================= TAB 1 ================= -->
    <section id="page-key" class="active">
      <p>ピアノ鍵盤をクリックすると、その音の指使いが表示されます。</p>
      <div id="piano" class="piano"></div>
      <div id="board-key" class="board"></div>
    </section>

    <!-- ================= TAB 2 ================= -->
    <section id="page-seq">
      <p>「ドレミファソラシ」の文字列を入力して <em>変換</em> ボタンを押すと、連続した運指が一度に表示されます。</p>
      <div class="seq-wrapper">
        <input id="seq-input" placeholder="例: ドレミファソ" />
        <button id="seq-btn" class="btn">変換</button>
      </div>
      <div id="board-seq" class="board"></div>
    </section>
  </main>

<script>
// ------------ Tab Logic --------------
const tabs = {
  key: {btn: document.getElementById('tab-key'), page: document.getElementById('page-key')},
  seq: {btn: document.getElementById('tab-seq'), page: document.getElementById('page-seq')}
};
Object.entries(tabs).forEach(([name,obj])=>{
  obj.btn.addEventListener('click',()=>switchTab(name));
});
function switchTab(active){
  Object.entries(tabs).forEach(([name,{btn,page}])=>{
    const isActive = name===active;
    btn.classList.toggle('active',isActive);
    page.classList.toggle('active',isActive);
  });
}

// ----------------- Mapping -----------------
const TOKEN2NOTE = {
  "ド":"C",
  "レ":"D",
  "ミ":"E",
  "ファ":"F",
  "ソ":"G",
  "ラ":"A",
  "シ":"B"
};
const NOTE2SOLFEGE = {
  "C":"ド","D":"レ","E":"ミ","F":"ファ","G":"ソ","A":"ラ","B":"シ","C2":"ド"
};
// -------- Fingering image paths --------
const IMG_PATH = './img/';
const FINGERING_IMG = {
  "C":  'fingering_C.png',
  "D":  'fingering_D.png',
  "E":  'fingering_E.png',
  "F":  'fingering_F.png',
  "G":  'fingering_G.png',
  "A":  'fingering_A.png',
  "B":  'fingering_B.png',
  "C2": 'fingering_C2.png'
};

// ------------- Piano build ------------------
const pianoRoot = document.getElementById('piano');
(function buildPiano(){
  const octaves=2;
  const white=["C","D","E","F","G","A","B"];
  const black=["C#","D#",null,"F#","G#","A#",null];
  for(let o=4;o<4+octaves;o++){
    white.forEach(n=>{
      const key=document.createElement('div');
      key.className='white-key';
      key.dataset.note=n;
      key.addEventListener('click',()=>renderSingle(n));
      pianoRoot.appendChild(key);
    });
    const whites=pianoRoot.querySelectorAll('.white-key');
    const start=whites.length-7;
    black.forEach((s,idx)=>{
      if(!s) return;
      const target=whites[start+idx];
      const bk=document.createElement('div');
      bk.className='black-key';
      bk.style.left=`${target.offsetLeft+36*(idx+1)-13}px`;
      bk.dataset.note=s.replace('#','');
      bk.addEventListener('click',()=>renderSingle(bk.dataset.note));
      pianoRoot.appendChild(bk);
    });
  }
})();

// -------------- Render helpers ----------------
const boardKey=document.getElementById('board-key');
const boardSeq=document.getElementById('board-seq');
function createCard(note){
  const wrap=document.createElement('div');
  wrap.className='card';
  const label=document.createElement('div');
  label.className='note-label';
  label.textContent=NOTE2SOLFEGE[note]||note;
  const img=document.createElement('img');
  img.src=IMG_PATH+FINGERING_IMG[note];
  img.alt=`${note} fingering`;
  wrap.appendChild(label);
  wrap.appendChild(img);
  return wrap;
}
function renderSingle(note){
  if(!FINGERING_IMG[note]){alert(`画像が見つかりません: ${note}`);return;}
  boardKey.innerHTML='';
  boardKey.appendChild(createCard(note));
}

// -------------- Sequence handler -------------
const seqBtn=document.getElementById('seq-btn');
seqBtn.addEventListener('click',()=>{
  const raw=document.getElementById('seq-input').value.trim();
  // Match longest kana tokens first (ファ is two chars)
  const tokens = raw.match(/ド|レ|ミ|ファ|ソ|ラ|シ/g) || [];
  boardSeq.innerHTML='';
  tokens.forEach(tok=>{
    const note=TOKEN2NOTE[tok];
    if(note && FINGERING_IMG[note]) boardSeq.appendChild(createCard(note));
  });
});
</script>
</body>
</html>
